"0","sort(unique(raw$Metric))"
"1"," [1]"
"1"," ""% Of Minutes On Saturday""                                             "
"1","
"
"1"," [2]"
"1"," ""% Of Minutes On Sunday""                                               "
"1","
"
"1"," [3]"
"1"," ""Average Days Until Patient Call Messages Marked Done""                 "
"1","
"
"1"," [4]"
"1"," ""Average Days Until Patient Medical Advice Request Message Marked Done"""
"1","
"
"1"," [5]"
"1"," ""Average Days Until Result Message Marked Done""                        "
"1","
"
"1"," [6]"
"1"," ""Average Days Until RX Auth Message Marked Done""                       "
"1","
"
"1"," [7]"
"1"," ""Count Of Appointments""                                                "
"1","
"
"1"," [8]"
"1"," ""Count Of Days In Reporting Period""                                    "
"1","
"
"1"," [9]"
"1"," ""Count Of Days In System""                                              "
"1","
"
"1","[10]"
"1"," ""Count Of Days of Afterhours Activity""                                 "
"1","
"
"1","[11]"
"1"," ""Count Of Days With Appointments""                                      "
"1","
"
"1","[12]"
"1"," ""Count Of In Basket Minutes""                                           "
"1","
"
"1","[13]"
"1"," ""Count Of Minutes Active On Unscheduled Days""                          "
"1","
"
"1","[14]"
"1"," ""Count Of Minutes Active Outside 7AM to 7PM""                           "
"1","
"
"1","[15]"
"1"," ""Count Of Minutes Active Outside Scheduled Time (30 Min Buffer)""       "
"1","
"
"1","[16]"
"1"," ""Count Of Minutes In The System""                                       "
"1","
"
"1","[17]"
"1"," ""Count Of Patient Call Messages Completed""                             "
"1","
"
"1","[18]"
"1"," ""Count Of Patient Call Messages Incomplete""                            "
"1","
"
"1","[19]"
"1"," ""Count Of Patient Call Messages Recieved""                              "
"1","
"
"1","[20]"
"1"," ""Count Of Patient Medical Advice Requests Messages Completed""          "
"1","
"
"1","[21]"
"1"," ""Count Of Patient Medical Advice Requests Messages Incomplete""         "
"1","
"
"1","[22]"
"1"," ""Count Of Patient Medical Advice Requests Messages Recieved""           "
"1","
"
"1","[23]"
"1"," ""Count Of Result Messages Completed""                                   "
"1","
"
"1","[24]"
"1"," ""Count Of Result Messages Incomplete""                                  "
"1","
"
"1","[25]"
"1"," ""Count Of Result Messages Recieved""                                    "
"1","
"
"1","[26]"
"1"," ""Count Of RX Auth Messages Completed""                                  "
"1","
"
"1","[27]"
"1"," ""Count Of RX Auth Messages Incomplete""                                 "
"1","
"
"1","[28]"
"1"," ""Count Of RX Auth Messages Recieved""                                   "
"1","
"
"1","[29]"
"1"," ""Count Of Saturday Minutes""                                            "
"1","
"
"1","[30]"
"1"," ""Count Of Scheduled Days""                                              "
"1","
"
"1","[31]"
"1"," ""Count Of Sunday Minutes""                                              "
"1","
"
"1","[32]"
"1"," ""Messages Received per Day - Patient Calls""                            "
"1","
"
"1","[33]"
"1"," ""Messages Received per Day - Patient Medical Advice Request""           "
"1","
"
"1","[34]"
"1"," ""Messages Received per Day - Results""                                  "
"1","
"
"1","[35]"
"1"," ""Messages Received per Day - Rx Auth""                                  "
"1","
"
"1","[36]"
"1"," ""Minutes Active On Unscheduled Days Per Day""                           "
"1","
"
"1","[37]"
"1"," ""Minutes In Clinical Review Per Appointment""                           "
"1","
"
"1","[38]"
"1"," ""Minutes In Clinical Review Per Day""                                   "
"1","
"
"1","[39]"
"1"," ""Minutes In In Basket Per Appointment""                                 "
"1","
"
"1","[40]"
"1"," ""Minutes In In Basket Per Day""                                         "
"1","
"
"1","[41]"
"1"," ""Minutes In Notes/Letters Per Appointment""                             "
"1","
"
"1","[42]"
"1"," ""Minutes In Orders Per Appointment""                                    "
"1","
"
"1","[43]"
"1"," ""Minutes In Other Per Day""                                             "
"1","
"
"1","[44]"
"1"," ""Scheduled Hours per Day""                                              "
"1","
"
"0","# Filter relevant metrics"
"0","filtered <- raw |>"
"0","  filter("
"0","    Metric %in% c("
"0","      # general load"
"0","      ""Count Of Scheduled Days"","
"0","      ""Scheduled Hours per Day"","
"0","      ""Count Of Appointments"","
"0","      ""Count Of Minutes In The System"","
"0","      "
"0","      # inbasket load"
"0","      ""Count Of In Basket Minutes"","
"0","      ""Count Of Patient Call Messages Recieved"","
"0","      ""Count Of Patient Medical Advice Requests Messages Recieved"","
"0","      ""Count Of Result Messages Recieved"","
"0","      ""Count Of RX Auth Messages Recieved"","
"0","      "
"0","      # responsiveness"
"0","      ""Average Days Until Patient Call Messages Marked Done"","
"0","      ""Average Days Until Patient Medical Advice Request Message Marked Done"","
"0","      ""Average Days Until Result Message Marked Done"","
"0","      ""Average Days Until RX Auth Message Marked Done"","
"0","      "
"0","      # afterhours load"
"0","      ""Count Of Minutes Active Outside Scheduled Time (30 Min Buffer)"","
"0","      ""Count Of Saturday Minutes"","
"0","      ""Count Of Sunday Minutes"""
"0","      )"
"0","    )"
"0",""
"0","# Data cleaning and transformation"
"0","clean <- filtered |>"
"0","  mutate("
"0","    "
"0","    id = as.character(DE_ID),"
"0","    "
"0","    type = "
"0","      as.factor("
"0","        case_when("
"0","          Grouper %in% c(""PHYSICIAN + PSYCHIATRIST"", ""NURSE PRACTITIONER"") ~ ""Attending"","
"0","          Grouper == ""RESIDENT + FELLOW"" ~ ""Trainee"","
"0","          TRUE ~ Grouper"
"0","          )"
"0","        ),"
"0","    "
"0","    # fix typo"
"0","    metric = str_replace(Metric, ""Recieved"", ""Received""),"
"0",""
"0","    ) |>"
"0","  "
"0","  # remove duplicates keeping one"
"0","  distinct(id, type, metric, .keep_all = TRUE) |>"
"0","  "
"0","  rowwise() |>"
"0","  "
"0","  mutate("
"0","    "
"0","    n_months = sum(!is.na(c_across(starts_with(c(""24-"", ""25-""))))),"
"0","    "
"0","    value = ifelse("
"0","      str_starts(metric, ""Average""),"
"0","      mean(c_across(starts_with(c(""24-"", ""25-""))), na.rm = TRUE),"
"0","      sum(c_across(starts_with(c(""24-"", ""25-""))), na.rm = TRUE)"
"0","      )"
"0",""
"0","    ) |> ungroup() |>"
"0","  "
"0","  select(id, type, metric, value, n_months) |>"
"0","  "
"0","  select(where(~ !all(is.na(.x) | .x == 0))) |>"
"0","  "
"0","  pivot_wider("
"0","    names_from  = metric,"
"0","    values_from = value"
"0","    ) |>"
"0","  "
"0","  clean_names()"
"0",""
"0","# Final calculations and aggregations"
"0","final <- clean |>"
"0","  rowwise() |>"
"0","  mutate("
"0","    # Aggregate message counts and averages"
"0","    count_of_messages_received = sum("
"0","      count_of_patient_call_messages_received,"
"0","      count_of_patient_medical_advice_requests_messages_received,"
"0","      count_of_result_messages_received,"
"0","      count_of_rx_auth_messages_received,"
"0","      na.rm = TRUE"
"0","    ),"
"0","    average_days_until_message_marked_done = mean("
"0","      average_days_until_patient_call_messages_marked_done,"
"0","      average_days_until_patient_medical_advice_request_message_marked_done,"
"0","      average_days_until_result_message_marked_done,"
"0","      average_days_until_rx_auth_message_marked_done,"
"0","      na.rm = TRUE"
"0","    ),"
"0","    "
"0","    # Time aggregations"
"0","    count_of_weekend_minutes = sum(count_of_saturday_minutes, count_of_sunday_minutes, na.rm = TRUE),"
"0","    count_of_afterhour_minutes = sum("
"0","      count_of_minutes_active_outside_scheduled_time_30_min_buffer,"
"0","      count_of_weekend_minutes,"
"0","      na.rm = TRUE"
"0","    ),"
"0","    "
"0","    # Convert to hours"
"0","    system_hours = count_of_minutes_in_the_system / 60,"
"0","    inbasket_hours = count_of_in_basket_minutes / 60,"
"0","    schedule_hours = scheduled_hours_per_day * count_of_scheduled_days,"
"0","    afterhours = count_of_afterhour_minutes / 60,"
"0","    "
"0","    # Ratios"
"0","    inbasket_ratio = count_of_in_basket_minutes / count_of_minutes_in_the_system,"
"0","    afterhours_ratio = count_of_afterhour_minutes / count_of_minutes_in_the_system,"
"0","  ) |>"
"0","  ungroup() |>"
"0","  "
"0","  mutate("
"0","    across(c(!starts_with(""average"") & !c(id, type, n_months)),"
"0","      ~ .x / n_months,"
"0","      .names = ""{.col}_per_month"")"
"0","  ) |>"
"0","  "
"0","  mutate("
"0","    across(c(count_of_appointments,"
"0","             count_of_messages_received,"
"0","             inbasket_hours, schedule_hours, system_hours, afterhours),"
"0","      ~ sum(.x, na.rm = TRUE),"
"0","      .names = ""{.col}_total""),"
"0","    .by = 1  # Create totals across all rows"
"0","  ) |>"
"0","  "
"0","  # Final selection and calculations"
"0","  transmute("
"0","    id, type, n_months,"
"0","    "
"0","    # General load"
"0","    appointments = count_of_appointments,"
"0","    schedule_hours, system_hours, afterhours,"
"0","    "
"0","    # General load per month"
"0","    appointments_per_month = count_of_appointments_per_month,"
"0","    schedule_hours_per_month, system_hours_per_month, afterhours_per_month,"
"0","    "
"0","    # Inbasket load"
"0","    inbasket_hours,"
"0","    msg = count_of_messages_received,"
"0","    msg_pc = count_of_patient_call_messages_received,"
"0","    msg_mar = count_of_patient_medical_advice_requests_messages_received,"
"0","    msg_res = count_of_result_messages_received,"
"0","    msg_rxa = count_of_rx_auth_messages_received,"
"0","    "
"0","    # Inbasket load per month"
"0","    inbasket_hours_per_month,"
"0","    msg_per_month = count_of_messages_received_per_month,"
"0","    msg_pc_per_month = count_of_patient_call_messages_received_per_month,"
"0","    msg_mar_per_month = count_of_patient_medical_advice_requests_messages_received_per_month,"
"0","    msg_res_per_month = count_of_result_messages_received_per_month,"
"0","    msg_rxa_per_month = count_of_rx_auth_messages_received_per_month,"
"0","    "
"0","    # Inbasket load per appointment"
"0","    inbasket_hours_per_appointment = inbasket_hours / appointments,"
"0","    msg_per_appointment = count_of_messages_received / appointments,"
"0","    msg_pc_per_appointment = count_of_patient_call_messages_received / appointments,"
"0","    msg_mar_per_appointment = count_of_patient_medical_advice_requests_messages_received / appointments,"
"0","    msg_res_per_appointment = count_of_result_messages_received / appointments,"
"0","    msg_rxa_per_appointment = count_of_rx_auth_messages_received / appointments,"
"0","    "
"0","    # Inbasket load per scheduled hour"
"0","    inbasket_hours_per_schedule_hour = inbasket_hours / schedule_hours,"
"0","    msg_per_schedule_hour = count_of_messages_received / schedule_hours,"
"0","    msg_pc_per_schedule_hour = count_of_patient_call_messages_received / schedule_hours,"
"0","    msg_mar_per_schedule_hour = count_of_patient_medical_advice_requests_messages_received / schedule_hours,"
"0","    msg_res_per_schedule_hour = count_of_result_messages_received / schedule_hours,"
"0","    msg_rxa_per_schedule_hour = count_of_rx_auth_messages_received / schedule_hours,"
"0","    "
"0","    # Responsiveness"
"0","    avg_dtc = average_days_until_message_marked_done,"
"0","    avg_dtc_pc = average_days_until_patient_call_messages_marked_done,"
"0","    avg_dtc_mar = average_days_until_patient_medical_advice_request_message_marked_done,"
"0","    avg_dtc_res = average_days_until_result_message_marked_done,"
"0","    avg_dtc_rxa = average_days_until_rx_auth_message_marked_done,"
"0","    "
"0","    # Shares"
"0","    appointments_share = appointments / count_of_appointments_total,"
"0","    msg_share = msg / count_of_messages_received_total,"
"0","    inbasket_hours_share = inbasket_hours / inbasket_hours_total,"
"0","    schedule_hours_share = schedule_hours / schedule_hours_total,"
"0","    system_hours_share = system_hours / system_hours_total,"
"0","    afterhours_share = afterhours / afterhours_total"
"0","  )"
"0",""
"0","# Save datasets"
"0","raw |> saveRDS(""raw.rds"")"
"0","clean |> saveRDS(""clean.rds"")"
"0","final |> saveRDS(""final.rds"")"
"0",""
"0",""
