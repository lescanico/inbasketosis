month = factor(month, levels = c("x24_01", "x24_02", "x24_03", "x24_04", "x24_05", "x24_06",
"x24_07", "x24_08", "x24_09", "x24_10", "x24_11", "x24_12",
"x25_01", "x25_02", "x25_03", "x25_04", "x25_05", "x25_06"))
) |>
ggplot(aes(x = month, y = value)) +
geom_line(group = 1) +
geom_point() +
labs(
title = "Trend of In-Basket Minutes Over Months",
x = "Month",
y = "Total In-Basket Minutes"
) +
theme_minimal()
# Plot metric trends across months
fig1 <- monthly |>
filter(str_starts(metric, "Count Of In-Basket Minutes")) |>
pivot_longer(starts_with(c("x24_", "x25_")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = c("x24_01", "x24_02", "x24_03", "x24_04", "x24_05", "x24_06",
"x24_07", "x24_08", "x24_09", "x24_10", "x24_11", "x24_12",
"x25_01", "x25_02", "x25_03", "x25_04", "x25_05", "x25_06"))
) |>
ggplot(aes(x = month, y = value)) +
geom_line(group = 1) +
geom_point() +
labs(
title = "Trend of In-Basket Minutes Over Months",
x = "Month",
y = "Total In-Basket Minutes"
) +
theme_minimal()
# Plot metric trends across months
fig1 <- monthly |>
filter(str_starts(metric, "Count Of In-Basket Minutes")) |>
pivot_longer(starts_with(c("24_", "25_")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"))
) |>
ggplot(aes(x = month, y = value)) +
geom_line(group = 1) +
geom_point() +
labs(
title = "Trend of In-Basket Minutes Over Months",
x = "Month",
y = "Total In-Basket Minutes"
) +
theme_minimal()
names(monthly)
# Plot metric trends across months
fig1 <- monthly |>
filter(str_starts(metric, "Count Of In-Basket Minutes")) |>
pivot_longer(starts_with(c("24", "25")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"))
) |>
ggplot(aes(x = month, y = value)) +
geom_line(group = 1) +
geom_point() +
labs(
title = "Trend of In-Basket Minutes Over Months",
x = "Month",
y = "Total In-Basket Minutes"
) +
theme_minimal()
fig1
View(monthly)
# Plot Count Of In Basket Minutes across months
ggplot(monthly |> filter(metric == "Count Of In Basket Minutes"), aes(x = name, y = value)) +
geom_bar(stat = "identity") +
labs(title = "Count Of In Basket Minutes Across Months", x = "Month", y = "Count Of In Basket Minutes")
# Plot Count Of In Basket Minutes across months
ggplot(monthly |> filter(metric == "Count Of In Basket Minutes"), aes(x = metric, y = value)) +
geom_bar(stat = "identity") +
labs(title = "Count Of In Basket Minutes Across Months", x = "Month", y = "Count Of In Basket Minutes")
# Plot Count Of In Basket Minutes across months
ggplot(monthly |> filter(metric == "Count Of In Basket Minutes"), aes(x = starts_with("24-", "25-") , y = value)) +
geom_bar(stat = "identity") +
labs(title = "Count Of In Basket Minutes Across Months", x = "Month", y = "Count Of In Basket Minutes")
# Plot Count Of In Basket Minutes across "24-" and "25-" months
ggplot(monthly |> filter(metric == "Count Of In Basket Minutes"),
aes(x = name, y = value, group = 1)) +
geom_line() +
geom_point() +
labs(
title = "Count Of In Basket Minutes Over Time",
x = "Month",
y = "Count Of In Basket Minutes"
) +
theme_minimal()
# Plot Count Of In Basket Minutes across months (first pivot longer)
monthly |>
filter(str_starts(metric, "Count Of In Basket Minutes")) |>
pivot_longer(starts_with(c("x24_", "x25_")), names_to = "month", values_to = "value") |>
ggplot(aes(x = month, y = value)) +
geom_boxplot() +
labs(
title = "Distribution of Count Of In Basket Minutes Across Months",
x = "Month",
y = "Count Of In Basket Minutes"
) +
theme_minimal()
# Plot Count Of In Basket Minutes across months (first pivot longer)
monthly |>
filter(str_starts(metric, "Count Of In Basket Minutes")) |>
pivot_longer(starts_with(c("24", "25")), names_to = "month", values_to = "value") |>
ggplot(aes(x = month, y = value)) +
geom_boxplot() +
labs(
title = "Distribution of Count Of In Basket Minutes Across Months",
x = "Month",
y = "Count Of In Basket Minutes"
) +
theme_minimal()
View(monthly)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value")
View(monthly)
monthly |> saveRDS("data/monthly.rds")
# Plot line of monthly totals for key metrics
ggplot(monthly |> filter(metric %in% c("Count Of Appointments", "Count Of In-Basket Minutes", "Count Of Patient Medical Advice Requests Messages Received")),
aes(x = month, y = value, color = metric, group = metric)) +
geom_line() +
geom_point() +
labs(
title = "Monthly Totals for Key Metrics",
x = "Month",
y = "Value",
color = "Metric"
) +
theme_minimal()
View(monthly)
# Plot line of monthly totals for key metrics
ggplot(monthly, aes(x = month, y = value, color = metric, group = metric)) +
geom_line() +
geom_point() +
labs(
title = "Monthly Totals for Key Metrics",
x = "Month",
y = "Value",
color = "Metric"
) +
theme_minimal()
# Plot line of monthly totals for key metrics
ggplot(monthly |> filter(metric %in% c("Count Of Appointments", "Count Of In-Basket Minutes", "Count Of Patient Medical Advice Requests Messages Received")), (x = month, y = value, color = metric, group = metric)) +
View(full)
View(final)
View(monthly)
# Plot metric values as lines over month
ggplot(monthly, aes(x = month, y = value, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Final
final <- clean |>
rowwise() |>
mutate(
n_months = sum(!is.na(c_across(starts_with(c("24-", "25-"))))),
tot = ifelse(str_starts(metric, "Count Of"),
sum(c_across(starts_with(c("24-", "25-"))), na.rm = TRUE),
mean(c_across(starts_with(c("24-", "25-"))), na.rm = TRUE)),
max = max(c_across(starts_with(c("24-", "25-"))), na.rm = TRUE)
) |> ungroup() |>
select(id, type, n_months, group, metric, tot, max) |>
pivot_wider(
names_from = metric,
values_from = c(tot, max),
names_sep = "_"
) |> clean_names() |>
transmute(
# object identifiers
id, type, group, n_months,
# general denominators
n_appt = tot_count_of_appointments,
n_sch_day = tot_count_of_scheduled_days,
n_sch_hrs = tot_scheduled_hours_per_day * n_sch_day,
sys_min = tot_count_of_minutes_in_the_system,
sys_hrs = sys_min / 60,
# message counts
n_mar = tot_count_of_patient_medical_advice_requests_messages_received,
n_pcm = tot_count_of_patient_call_messages_received,
n_res = tot_count_of_result_messages_received,
n_rxa = tot_count_of_rx_auth_messages_received,
n_msg = n_mar + n_pcm + n_res + n_rxa,
# in-basket load
ib_min = tot_count_of_in_basket_minutes,
ib_hrs = ib_min / 60,
ib_min_per_msg = ifelse(n_msg > 0, ib_min / n_msg, NA),
ib_sys_ratio = ib_min / sys_min,
ib_sch_ratio = ib_hrs / n_sch_hrs,
# average days to complete (dtc)
dtc_mar = tot_average_days_until_patient_medical_advice_request_message_marked_done,
dtc_pcm = tot_average_days_until_patient_call_messages_marked_done,
dtc_res = tot_average_days_until_result_message_marked_done,
dtc_rxa = tot_average_days_until_rx_auth_message_marked_done,
dtc_msg = (dtc_mar + dtc_pcm + dtc_res + dtc_rxa) / 4,
# afterhours
min_ost = tot_count_of_minutes_active_outside_scheduled_time_30_min_buffer,
min_oud = tot_count_of_minutes_active_on_unscheduled_days,
min_sat = tot_count_of_saturday_minutes,
min_sun = tot_count_of_sunday_minutes,
ah_min = min_ost + min_oud + min_sat + min_sun,
ah_hrs = ah_min / 60,
ah_sys_ratio = ah_min / sys_min,
# minutes per appointment (mpa)
ib_mpa = tot_minutes_in_in_basket_per_appointment,
cr_mpa = tot_minutes_in_clinical_review_per_appointment,
nl_mpa = tot_minutes_in_notes_letters_per_appointment,
or_mpa = tot_minutes_in_orders_per_appointment,
mpa = ib_mpa + cr_mpa + nl_mpa + or_mpa,
# mpa proportions
ib_mpa_pct = ifelse(ib_mpa > 0, ib_mpa / mpa, NA),
cr_mpa_pct = ifelse(cr_mpa > 0, cr_mpa / mpa, NA),
nl_mpa_pct = ifelse(nl_mpa > 0, nl_mpa / mpa, NA),
or_mpa_pct = ifelse(or_mpa > 0, or_mpa / mpa, NA),
# per month (pm)
appt_pm = n_appt / n_months,
sch_day_pm = n_sch_day / n_months,
sch_hrs_pm = n_sch_hrs / n_months,
sys_hrs_pm = sys_hrs / n_months,
ah_hrs_pm = ah_hrs / n_months,
ib_hrs_pm = ib_hrs / n_months,
msg_pm = n_msg / n_months,
mar_pm = n_mar / n_months,
pcm_pm = n_pcm / n_months,
res_pm = n_res / n_months,
rxa_pm = n_rxa / n_months,
# monthly max values
appt_max = max_count_of_appointments,
sch_day_max = max_count_of_scheduled_days,
sch_hrs_max = max_scheduled_hours_per_day * sch_day_max,
sys_hrs_max = max_count_of_minutes_in_the_system / 60,
ah_hrs_max = (max_count_of_minutes_active_outside_scheduled_time_30_min_buffer +
max_count_of_minutes_active_on_unscheduled_days +
max_count_of_saturday_minutes +
max_count_of_sunday_minutes) / 60,
ib_hrs_max = max_count_of_in_basket_minutes / 60,
mar_max = max_count_of_patient_medical_advice_requests_messages_received,
pcm_max = max_count_of_patient_call_messages_received,
res_max = max_count_of_result_messages_received,
rxa_max = max_count_of_rx_auth_messages_received,
msg_max = mar_max + pcm_max + res_max + rxa_max
)
final$ib_min_per_msg
summary(final$ib_min_per_msg)
descr(final$ib_min_per_msg)
descr(final$ib_hrs)
descr(final$ib_hrs_pm)
descr(final$ib_mpa_pct)
descr(final$ah_hrs)
descr(final$ah_hrs_pm)
unique(monthly$metric)
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value / 60, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(month = factor(month, levels = sort(unique(month)))))
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = sort(unique(month)))
)
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value / 60, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = "24-jul", "24-aug", "24-sep", "24-oct", "24-nov", "24-dec",
"25-jan", "25-feb", "25-mar", "25-apr", "25-may")
)
View(monthly)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = "24-Jul", "24-Aug", "24-Sep", "24-Oct", "24-Nov", "24-Dec",
"25-Jan", "25-Feb", "25-Mar", "25-Apr", "25-May", "25-Jun")
)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(
month = factor(month, levels = "24-Jul", "24-Aug", "24-Sep", "24-Oct", "24-Nov", "24-Dec",
"25-Jan", "25-Feb", "25-Mar", "25-Apr", "25-May", "25-Jun")
)
unique(monthly%month)
unique(monthly$month)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
mutate(
month = as.factor(month, levels = "24-Jul", "24-Aug", "24-Sep", "24-Oct", "24-Nov", "24-Dec",
"25-Jan", "25-Feb", "25-Mar", "25-Apr", "25-May", "25-Jun")
)
mutate(
month = factor(month, levels = sort(unique(month)))
)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
# sort month levels (chronologically)
mutate(
month = factor(month, levels = sort(unique(month)))
)
unique(monthly$month)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
# sort month levels (24-Jul, 24-Aug, ...)
mutate(
month = factor(
month,
levels = "24-Jul", "24-Aug", "24-Sep", "24-Oct", "24-Nov", "24-Dec",
"25-Jan", "25-Feb", "25-Mar", "25-Apr", "25-May", "25-Jun"
)
)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
# sort month levels (24-Jul, 24-Aug, ...)
mutate(
month = factor(
month,
levels = sort("24-Jul", "24-Aug", "24-Sep", "24-Oct", "24-Nov", "24-Dec",
"25-Jan", "25-Feb", "25-Mar", "25-Apr", "25-May", "25-Jun")
)
)
# Monthly
monthly <- clean |>
summarise(
across(
starts_with(c("24-", "25-")),
~ as.numeric(case_when(str_starts(metric[1], "Count Of") ~ sum(.x, na.rm = TRUE),
TRUE ~ mean(.x, na.rm = TRUE)))),
.by = metric
) |>
pivot_longer(starts_with(c("24-", "25-")), names_to = "month", values_to = "value") |>
# convert month to date
mutate(
month = as.Date(paste0(str_replace(month, "-", "-01-"), "01"), format = "%y-%m"
)
)
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value / 60, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Plot metric values as lines over month
ggplot(monthly |> filter(metric %in% "Count Of In Basket Minutes"), aes(x = month, y = value / 60, group = metric, color = metric)) +
geom_line() +
theme_minimal() +
labs(
title = "Monthly Metrics Over Time",
x = "Month",
y = "Value"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
metric_plots <- lapply(metrics_to_plot, function(metric_name) {
metric_data <- monthly %>%
filter(metric == metric_name)
ggplot(metric_data, aes(x = month, y = value)) +
geom_line() +
geom_point() +
labs(
title = metric_name,
x = "Month",
y = "Value"
) +
theme_minimal()
})
metrics_to_plot <- c(
"Count Of Patient Medical Advice Requests Messages Received",
"Count Of Patient Call Messages Received",
"Count Of Result Messages Received",
"Count Of Rx Auth Messages Received",
"Count Of In-Basket Minutes",
"Count Of Minutes Active Outside Scheduled Time 30 Min Buffer"
)
metric_plots <- lapply(metrics_to_plot, function(metric_name) {
metric_data <- monthly %>%
filter(metric == metric_name)
ggplot(metric_data, aes(x = month, y = value)) +
geom_line() +
geom_point() +
labs(
title = metric_name,
x = "Month",
y = "Value"
) +
theme_minimal()
})
metric_plots
View(metric_plots)
